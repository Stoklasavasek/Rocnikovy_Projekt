{% extends "base.html" %}
{% load wagtailcore_tags %}
{# Šablona pro jednoduchý režim kvízu (bez live sezení) - student vyplní kvíz samostatně #}

{% block extra_js %}
<script>
function toggleMaterial(index) {
  const content = document.getElementById(`content-${index}`);
  const toggle = document.getElementById(`toggle-${index}`);
  if (content && toggle) {
    const isHidden = content.style.display === 'none';
    content.style.display = isHidden ? 'block' : 'none';
    toggle.textContent = isHidden ? '▲' : '▼';
  }
}
</script>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-8 text-center">{{ quiz.title }}</h1>
  
  {# Zobrazení vzdělávacích materiálů před kvízem #}
  {% if educational_materials %}
    <div class="card-modern mb-8" style="background: #1f2937 !important; border: 2px solid #374151 !important;">
      <h2 class="text-2xl font-bold mb-4" style="color: #f9fafb !important;">Vzdělávací materiály</h2>
      <p class="mb-4" style="color: #d1d5db !important;">Před začátkem kvízu si můžete prostudovat následující materiály:</p>
      <ul class="material-list">
        {% for material in educational_materials %}
          <li class="material-item pad-sm bg-card rounded my-2">
            <div class="material-header" onclick="toggleMaterial({{ forloop.counter0 }})">
              <div>
                <h3>{{ material.title }}</h3>
                <p class="text-muted">
                  Typ: {{ material.get_material_type_display }}
                  {% if material.video_file %}
                    | <a href="{{ material.video_file.url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); window.open(this.href, '_blank'); return false;">Video soubor ↗</a>
                  {% elif material.document_file %}
                    | <a href="{{ material.document_file.url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); window.open(this.href, '_blank'); return false;">Dokument ↗</a>
                  {% elif material.external_url %}
                    | <a href="{{ material.external_url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); window.open(this.href, '_blank'); return false;">Externí odkaz ↗</a>
                  {% endif %}
                </p>
              </div>
              <span class="material-toggle" id="toggle-{{ forloop.counter0 }}">▼</span>
            </div>
            {% if material.content %}
              <div class="material-content my-2" id="content-{{ forloop.counter0 }}">
                {{ material.content|richtext }}
              </div>
            {% endif %}
            {% if material.video_file %}
              <div class="material-content my-2" id="content-{{ forloop.counter0 }}">
                <video controls style="width: 100%; max-width: 800px;">
                  <source src="{{ material.video_file.url }}" type="video/mp4">
                  Váš prohlížeč nepodporuje video tag.
                </video>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
  
  {# Formulář s otázkami a odpověďmi #}
  <form method="post" class="space-y-6">
    {% csrf_token %}
    {% for question in questions %}
      <div class="card-modern">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Otázka {{ forloop.counter }}: {{ question.text }}</h3>
        
        {# Zobrazení obrázku otázky, pokud existuje #}
        {% if question.image %}
          <div class="mb-4 rounded-lg overflow-hidden">
            <img src="{{ question.image.url }}" alt="Obrázek k otázce" class="w-full h-auto rounded-lg">
          </div>
        {% endif %}
        
        {# Seznam možných odpovědí (radio buttons) #}
        <ul class="space-y-3">
          {% for answer in question.answers.all %}
            <li>
              <label class="flex items-center p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 hover:border-indigo-400 dark:hover:border-indigo-500 cursor-pointer transition-colors bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                <input type="radio" name="question_{{ question.id }}" value="{{ answer.id }}" required class="mr-3 w-5 h-5 text-indigo-600 focus:ring-indigo-500">
                <span class="text-gray-900 dark:text-gray-100 font-medium">{{ answer.text }}</span>
              </label>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
    
    {# Tlačítko pro odeslání odpovědí #}
    <div class="flex justify-center pt-6">
      <button type="submit" class="btn-primary px-8 py-4 text-lg font-bold">
        Odeslat odpovědi
      </button>
    </div>
  </form>
</div>
{% endblock %}

