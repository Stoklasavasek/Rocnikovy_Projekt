{% extends "base.html" %}
{% load quiz_tags %}
{% load wagtailcore_tags %}
{% block content %}
<div class="container quiz-container">
  <h1 class="quiz-title">{{ session.quiz.title }}</h1>
  {% if qrun.question.image %}
    <div class="question-image">
      <img src="{{ qrun.question.image.url }}" alt="ObrÃ¡zek k otÃ¡zce">
    </div>
  {% endif %}
  <h2 class="quiz-question">OtÃ¡zka {{ qrun.order }}: {{ qrun.question.text }}</h2>
  {% if remaining %}
    <p class="timer-display">ZbÃ½vajÃ­cÃ­ Äas: <span class="remaining-time">{{ remaining }}</span> s</p>
  {% endif %}

  <script>
    (function() {
      // Timer
      const remainingEl = document.querySelector('.remaining-time');
      let timerInterval = null;
      
      function stopTimer() {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }
      window.stopTimerIfRunning = stopTimer;
      
      if (remainingEl) {
        let currentTime = parseInt(remainingEl.textContent.trim()) || 0;
        {% if not is_host and has_answered %}
        stopTimer();
        {% elif not is_host or not all_answered %}
        timerInterval = setInterval(() => {
          if (currentTime > 0) {
            remainingEl.textContent = --currentTime;
          } else {
            stopTimer();
            {% if not is_host %}
            const form = document.getElementById('answer-form');
            const msg = document.getElementById('time-over-message');
            if (form) form.classList.add('time-over-hidden');
            if (msg) msg.classList.remove('time-over-hidden');
            {% endif %}
          }
        }, 1000);
        {% endif %}
      }
      
      // Socket.IO pro studenty
      {% if not is_host %}
      const hash = "{{ session.hash }}";
      const currentOrder = {{ qrun.order }};
      const studentStatusUrl = "{% url 'session_status' session.hash %}";
      const studentResultsUrl = "{% url 'session_results' session.hash %}";
      
      function createFallback() {
        return setInterval(async () => {
          try {
            const res = await fetch(studentStatusUrl, {headers: {'X-Requested-With': 'XMLHttpRequest'}});
            if (res.ok) {
              const data = await res.json();
              if (data.state === 'finished') {
                clearInterval(this);
                window.location.href = studentResultsUrl;
              } else if (data.state === 'question' && data.order !== currentOrder) {
                clearInterval(this);
                window.location.href = "/session/" + hash + "/q/" + data.order + "/";
              }
            }
          } catch (e) {}
        }, 2000);
      }
      
      if (typeof io === 'undefined') {
        createFallback();
        return;
      }
      
      const socket = io('http://localhost:8001', {
        transports: ['websocket', 'polling'],
        reconnection: true,
        reconnectionDelay: 500,
        reconnectionAttempts: 10
      });
      
      socket.on('disconnect', createFallback);
      socket.on('connect', () => socket.emit('join_session', {hash: hash}));
      if (socket.connected) socket.emit('join_session', {hash: hash});
      
      socket.on('session_state', (data) => {
        if (data.state === 'finished') {
          window.location.href = studentResultsUrl;
        } else if (data.state === 'question' && data.order !== currentOrder) {
          window.location.href = "/session/" + hash + "/q/" + data.order + "/";
        } else if (data.state === 'question' && !document.querySelector('form[action*="submit"]')) {
          {% if not has_answered %}
          location.reload();
          {% endif %}
        }
      });
      {% endif %}
    })();
  </script>

  {% if is_host %}
    <div class="card pad stats-card">
      <h3>Statistiky odpovÄ›dÃ­</h3>
      <p><strong>OdpovÄ›dÄ›lo: <span class="answered-count stats-badge" id="answered-count">{{ answered_count }}</span> / <span class="stats-badge" id="total-participants">{{ total_participants }}</span></strong></p>
      
      {% if all_answered or time_over %}
      <div class="stats-section">
        <h4>VÃ½sledky podle odpovÄ›dÃ­:</h4>
        <ul class="stats-list">
          {% for answer in qrun.question.answers.all %}
          {% with stats=answer_stats|get_item:answer.id %}
          <li data-answer-id="{{ answer.id }}" class="answer-item {% if answer.is_correct %}correct{% else %}wrong{% endif %}">
            <div class="stats-item-wrapper">
              <div class="stats-item-text">
                <strong>{% if answer.is_correct %}âœ“{% else %}âœ—{% endif %} {{ answer.text }}</strong>
              </div>
              <div class="stats-number {% if answer.is_correct %}correct{% else %}wrong{% endif %}" data-answer-id="{{ answer.id }}">
                {% if stats %}{{ stats.count }}{% else %}0{% endif %}
              </div>
            </div>
          </li>
          {% endwith %}
          {% endfor %}
        </ul>
      </div>
      {% else %}
      <div class="stats-section waiting">
        <h4>PrÅ¯bÄ›Å¾nÃ© vÃ½sledky:</h4>
        <ul class="stats-list">
          {% for answer in qrun.question.answers.all %}
          {% with stats=answer_stats|get_item:answer.id %}
          <li data-answer-id="{{ answer.id }}" class="answer-item waiting">
            <div class="stats-item-wrapper">
              <div class="stats-item-text"><strong>{{ answer.text }}</strong></div>
              <div class="stats-number wrong" data-answer-id="{{ answer.id }}">
                {% if stats %}{{ stats.count }}{% else %}0{% endif %}
              </div>
            </div>
          </li>
          {% endwith %}
          {% endfor %}
        </ul>
        <p class="waiting-message">ÄŒekÃ¡me na odpovÄ›di vÅ¡ech ÃºÄastnÃ­kÅ¯...</p>
      </div>
      {% endif %}
      
      <div class="tables-grid">
        <div>
          <h4 class="participants-table-header">PrÅ¯bÄ›Å¾nÃ½ Å¾ebÅ™Ã­Äek:</h4>
          <div class="participants-table-wrapper">
            <table class="results-table">
              <thead>
                <tr class="table-header-row">
                  <th>#</th>
                  <th>ÃšÄastnÃ­k</th>
                  <th>Body</th>
                </tr>
              </thead>
              <tbody id="leaderboard-body">
                {% for item in participant_leaderboard %}
                <tr class="table-data-row {% if forloop.counter0 == 0 and item.score > 0 %}correct-answer-row{% endif %}">
                  <td class="table-cell">{{ forloop.counter }}.</td>
                  <td class="table-cell">{{ item.participant.display_name }}</td>
                  <td class="table-cell"><strong>{{ item.score }}</strong></td>
                </tr>
                {% empty %}
                <tr><td colspan="3" class="table-cell">Å½Ã¡dnÃ­ ÃºÄastnÃ­ci.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        
        <div>
          <h4 class="participants-table-header">Kdo jak odpovÄ›dÄ›l:</h4>
          <div class="participants-table-wrapper">
            <table class="results-table">
              <thead>
                <tr class="table-header-row">
                  <th>ÃšÄastnÃ­k</th>
                  <th>OdpovÄ›Ä</th>
                  <th>Stav</th>
                </tr>
              </thead>
              <tbody id="participants-responses-body">
                {% for p in participants %}
                {% with resp=participant_responses|get_item:p.id %}
                <tr class="table-data-row participant-row" data-participant-id="{{ p.id }}" {% if all_answered or time_over %}{% if resp and resp.is_correct %}data-is-correct="true"{% elif resp and not resp.is_correct %}data-is-correct="false"{% endif %}{% endif %}>
                  <td class="table-cell">{{ p.display_name }}</td>
                  <td class="table-cell participant-answer">{% if resp %}{{ resp.answer.text }}{% else %}NeodpovÄ›dÄ›l{% endif %}</td>
                  <td class="table-cell participant-status">
                    {% if resp %}
                      {% if all_answered or time_over %}
                        {% if resp.is_correct %}SprÃ¡vnÄ› âœ“{% else %}Å patnÄ› âœ—{% endif %}
                      {% else %}
                        OdpovÄ›dÄ›l
                      {% endif %}
                    {% else %}
                      NeodpovÄ›dÄ›l
                    {% endif %}
                  </td>
                </tr>
                {% endwith %}
                {% empty %}
                <tr><td colspan="3" class="table-cell">Å½Ã¡dnÃ­ ÃºÄastnÃ­ci.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <div class="session-actions">
        {% if next_exists %}
          <a href="{% url 'session_start_question' session.hash qrun.order|add:1 %}" class="btn primary success session-action-btn">
            PÅ™ejÃ­t na dalÅ¡Ã­ otÃ¡zku
          </a>
        {% else %}
          <a href="{% url 'session_finish' session.hash %}" class="btn primary danger session-action-btn">
            UkonÄit sezenÃ­
          </a>
        {% endif %}
      </div>
    </div>
  {% else %}
    {% if not question_started %}
      <div class="status-message warning">
        <p><strong>â¸ï¸ OtÃ¡zka jeÅ¡tÄ› nebÄ›Å¾Ã­.</strong> PoÄkejte, aÅ¾ uÄitel spustÃ­ otÃ¡zku.</p>
      </div>
      
      {# VzdÄ›lÃ¡vacÃ­ materiÃ¡ly pÅ™ed otÃ¡zkou #}
      {# PoznÃ¡mka: ZobrazujÃ­ se pouze kdyÅ¾ otÃ¡zka jeÅ¡tÄ› nebÄ›Å¾Ã­, ne bÄ›hem kvÃ­zu #}
      {% if educational_materials_before %}
        <div class="educational-materials card pad my-4">
          <h2>VzdÄ›lÃ¡vacÃ­ materiÃ¡ly</h2>
          <p class="text-muted">PÅ™ed zaÄÃ¡tkem otÃ¡zky si mÅ¯Å¾ete prostudovat nÃ¡sledujÃ­cÃ­ materiÃ¡ly:</p>
          <ul class="material-list">
            {% for material in educational_materials_before %}
              <li class="material-item pad-sm bg-card rounded my-2">
                <div class="material-header" onclick="toggleMaterialBefore({{ forloop.counter0 }})">
                  <div>
                    <h3><a href="{% pageurl material %}" onclick="event.stopPropagation();">{{ material.title }}</a></h3>
                    <p class="text-muted">
                      Typ: {{ material.get_material_type_display }}
                      {% if material.external_url %}
                        | <a href="{{ material.external_url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">ExternÃ­ odkaz â†—</a>
                      {% endif %}
                    </p>
                  </div>
                  <span class="material-toggle" id="toggle-before-{{ forloop.counter0 }}">â–¼</span>
                </div>
                {% if material.content %}
                  <div class="material-content my-2" id="content-before-{{ forloop.counter0 }}">
                    {{ material.content|richtext }}
                  </div>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    {% elif has_answered %}
      <div class="status-message info">
        <p>OdpovÄ›Ä pÅ™ijata. ÄŒekejte, neÅ¾ odpovÃ­ ostatnÃ­ studenti nebo uÄitel spustÃ­ dalÅ¡Ã­ otÃ¡zku.</p>
      </div>
      {% if current_response %}
        <div class="points-display">
          <div class="points-current">
            <div class="points-label">Body za tuto otÃ¡zku:</div>
            <div class="points-value">{{ current_points }}</div>
            {% if current_response.is_correct %}
              <div class="points-status points-correct">âœ“ SprÃ¡vnÄ›</div>
            {% else %}
              <div class="points-status points-wrong">âœ— Å patnÄ› (0 bodÅ¯)</div>
            {% endif %}
          </div>
          <div class="points-total">
            <div class="points-label">CelkovÃ© body:</div>
            <div class="points-value-large">{{ total_points }}</div>
          </div>
        </div>
      {% endif %}
    {% elif time_over %}
      <div class="status-message error">
        <p>ÄŒas na odpovÄ›Ä vyprÅ¡el. NeodpovÄ›dÄ›li jste. ÄŒekejte, neÅ¾ uÄitel spustÃ­ dalÅ¡Ã­ otÃ¡zku.</p>
      </div>
    {% else %}
    {% if not is_host and question_started and not has_answered %}
      {% if session.quiz.jokers_count > 0 and jokers_remaining > 0 %}
        <button id="joker-btn" class="joker-button" title="PouÅ¾Ã­t Å¾olÃ­k (zbÃ½vÃ¡ {{ jokers_remaining }})">
          ğŸƒ {{ jokers_remaining }}
        </button>
      {% endif %}
    {% endif %}
    <form action="{% url 'session_submit_answer' session.hash qrun.order %}" method="post" class="answer-form" id="answer-form">
      {% csrf_token %}
      <ul class="answer-list" id="answer-list">
        {% for a in qrun.question.answers.all %}
          <li data-answer-id="{{ a.id }}">
            <label class="answer-label">
              <input type="radio" name="answer_id" value="{{ a.id }}" required>
              <span>{{ a.text }}</span>
            </label>
          </li>
        {% endfor %}
      </ul>
      <button type="submit" class="btn primary submit-btn-full">Odeslat odpovÄ›Ä</button>
    </form>
    <div id="time-over-message" class="status-message error time-over-hidden">
      <p>ÄŒas na odpovÄ›Ä vyprÅ¡el. NeodpovÄ›dÄ›li jste. ÄŒekejte, neÅ¾ uÄitel spustÃ­ dalÅ¡Ã­ otÃ¡zku.</p>
    </div>
    <script>
      document.getElementById('answer-form')?.addEventListener('submit', function() {
        if (window.stopTimerIfRunning) window.stopTimerIfRunning();
      });
      
      {% if not is_host and session.quiz.jokers_count > 0 and jokers_remaining > 0 and question_started and not has_answered %}
      (() => {
        const jokerBtn = document.getElementById('joker-btn');
        const answerList = document.getElementById('answer-list');
        if (!jokerBtn || !answerList) return;
        
        const jokerUrl = "{% url 'session_use_joker' session.hash qrun.order %}";
        const totalAnswers = {{ qrun.question.answers.count }};
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
        
        jokerBtn.addEventListener('click', async () => {
          if (!confirm('Opravdu chceÅ¡ pouÅ¾Ã­t Å¾olÃ­k? SmaÅ¾e se 2 Å¡patnÃ© odpovÄ›di a mÅ¯Å¾eÅ¡ mÃ­t 50% Å¡anci na polovinu moÅ¾nostÃ­.')) return;
          
          jokerBtn.disabled = true;
          jokerBtn.textContent = 'â³';
          
          try {
            const res = await fetch(jokerUrl, {
              method: 'POST',
              headers: {'X-CSRFToken': csrfToken, 'Content-Type': 'application/json'},
              body: '{}'
            });
            const data = await res.json();
            
            if (data.success) {
              answerList.innerHTML = data.remaining_answers.map(a => 
                `<li data-answer-id="${a.id}">
                  <label class="answer-label">
                    <input type="radio" name="answer_id" value="${a.id}" required>
                    <span>${a.text}</span>
                  </label>
                </li>`
              ).join('');
              
              if (data.jokers_remaining > 0) {
                jokerBtn.textContent = `ğŸƒ ${data.jokers_remaining}`;
                jokerBtn.title = `PouÅ¾Ã­t Å¾olÃ­k (zbÃ½vÃ¡ ${data.jokers_remaining})`;
                jokerBtn.disabled = false;
              } else {
                jokerBtn.remove();
              }
              
              const msg = data.remaining_answers.length < totalAnswers 
                ? `ZÅ¯staly ti ${data.remaining_answers.length} moÅ¾nosti.` 
                : 'SmaÅ¾eny 2 Å¡patnÃ© odpovÄ›di.';
              alert(`Å½olÃ­k pouÅ¾it! ${msg}`);
            } else {
              alert(`Chyba: ${data.error || 'NepodaÅ™ilo se pouÅ¾Ã­t Å¾olÃ­k.'}`);
              jokerBtn.disabled = false;
              jokerBtn.textContent = 'ğŸƒ {{ jokers_remaining }}';
            }
          } catch (e) {
            alert('Chyba pÅ™i pouÅ¾itÃ­ Å¾olÃ­ku.');
            jokerBtn.disabled = false;
            jokerBtn.textContent = 'ğŸƒ {{ jokers_remaining }}';
          }
        });
      })();
      {% endif %}
    </script>
    {% endif %}
  {% endif %}
</div>

{% if is_host %}
<script>
(function() {
  let lastCount = {{ answered_count }};
  let allAnswered = {{ all_answered|yesno:"true,false" }};
  let timeOver = {{ time_over|yesno:"true,false" }};
  const order = {{ qrun.order }};
  const hash = "{{ session.hash }}";
  const statusUrl = "{% url 'session_status' session.hash %}";
  const resultsUrl = "{% url 'session_results' session.hash %}";
  // MapovÃ¡nÃ­ answer_id -> is_correct pro aktualizaci statistik
  const correctAnswers = {
    {% for answer in qrun.question.answers.all %}
    "{{ answer.id }}": {{ answer.is_correct|yesno:"true,false" }}{% if not forloop.last %},{% endif %}
    {% endfor %}
  };
  
  function updateLeaderboard(leaderboard) {
    const tbody = document.getElementById('leaderboard-body');
    if (!tbody) return;
    
    if (!leaderboard || leaderboard.length === 0) {
      tbody.innerHTML = '<tr><td colspan="3" class="table-cell">Å½Ã¡dnÃ­ ÃºÄastnÃ­ci.</td></tr>';
      return;
    }
    
    tbody.innerHTML = '';
    leaderboard.forEach((item, index) => {
      const row = document.createElement('tr');
      row.className = 'table-data-row' + (index === 0 && item.score > 0 ? ' correct-answer-row' : '');
      row.innerHTML = `
        <td class="table-cell">${index + 1}.</td>
        <td class="table-cell">${item.name}</td>
        <td class="table-cell"><strong>${item.score}</strong></td>
      `;
      tbody.appendChild(row);
    });
  }
  
  function updateParticipantsResponses(participantResponses, allAnswered, timeOver) {
    const tbody = document.getElementById('participants-responses-body');
    if (!tbody || !participantResponses) return;
    
    tbody.querySelectorAll('.participant-row').forEach(row => {
      const participantId = row.getAttribute('data-participant-id');
      const resp = participantResponses[participantId] || participantResponses[String(participantId)];
      const answerCell = row.querySelector('.participant-answer');
      const statusCell = row.querySelector('.participant-status');
      if (!answerCell || !statusCell) return;
      
      if (resp?.answer_text) {
        answerCell.textContent = resp.answer_text;
        const showResult = allAnswered || timeOver;
        statusCell.textContent = showResult ? (resp.is_correct ? 'SprÃ¡vnÄ› âœ“' : 'Å patnÄ› âœ—') : 'OdpovÄ›dÄ›l';
        row.className = 'table-data-row participant-row';
        if (showResult) {
          row.classList.add(resp.is_correct ? 'correct-answer-row' : 'wrong-answer-row');
          row.setAttribute('data-is-correct', resp.is_correct.toString());
        } else {
          row.removeAttribute('data-is-correct');
        }
      } else {
        answerCell.textContent = statusCell.textContent = 'NeodpovÄ›dÄ›l';
        row.className = 'table-data-row participant-row';
        row.removeAttribute('data-is-correct');
      }
    });
  }
  
  function updateStatsFromData(data) {
    const dataOrder = data.question_order ?? data.order;
    if (!data || (dataOrder !== undefined && dataOrder !== order)) return;
    
    // Aktualizace poÄtu odpovÄ›dÃ­
    if (data.answered_count !== undefined) {
      lastCount = data.answered_count;
      const countEl = document.getElementById('answered-count');
      if (countEl) countEl.textContent = data.answered_count;
    }
    
    // Aktualizace statistik odpovÄ›dÃ­
    if (data.answer_stats) {
      const showResult = data.all_answered || data.time_over;
      for (const aid in data.answer_stats) {
        const statEl = document.querySelector(`.stats-number[data-answer-id="${aid}"]`);
        if (statEl) {
          statEl.textContent = data.answer_stats[aid];
          if (showResult && correctAnswers[aid] !== undefined) {
            statEl.classList.remove('wrong', 'correct');
            statEl.classList.add(correctAnswers[aid] ? 'correct' : 'wrong');
          }
        }
      }
    }
    
    // Aktualizace Å¾ebÅ™Ã­Äku a tabulky ÃºÄastnÃ­kÅ¯
    if (data.leaderboard) updateLeaderboard(data.leaderboard);
    if (data.participant_responses) {
      updateParticipantsResponses(data.participant_responses, data.all_answered || false, data.time_over || false);
    }
    
    // Aktualizace zobrazenÃ­ po ukonÄenÃ­ otÃ¡zky
    if (data.all_answered && !allAnswered) {
      allAnswered = true;
      const statsSection = document.querySelector('.stats-section.waiting');
      if (statsSection) {
        statsSection.classList.remove('waiting');
        statsSection.querySelector('.waiting-message')?.remove();
        const h4 = statsSection.querySelector('h4');
        if (h4) h4.textContent = 'VÃ½sledky podle odpovÄ›dÃ­:';
        statsSection.querySelectorAll('.answer-item').forEach(item => {
          const answerId = item.getAttribute('data-answer-id');
          const isCorrect = correctAnswers[answerId];
          if (isCorrect !== undefined) {
            item.classList.remove('waiting');
            item.classList.add(isCorrect ? 'correct' : 'wrong');
            const textEl = item.querySelector('.stats-item-text strong');
            if (textEl) {
              textEl.innerHTML = (isCorrect ? 'âœ“' : 'âœ—') + ' ' + textEl.textContent.replace(/^[âœ“âœ—]\s*/, '');
            }
          }
        });
      }
      setTimeout(() => location.reload(), 1000);
    }
    
    if (data.time_over && !timeOver) {
      timeOver = true;
      setTimeout(() => location.reload(), 500);
    }
  }
  
  // Fallback pro AJAX polling (kdyÅ¾ Socket.IO nenÃ­ dostupnÃ©)
  function createFallback() {
    return setInterval(async () => {
      try {
        const res = await fetch(statusUrl, {headers: {'X-Requested-With': 'XMLHttpRequest'}});
        if (res.ok) {
          const data = await res.json();
          if (data.state === 'finished') {
            clearInterval(this);
            window.location.href = resultsUrl;
          } else if (data.state === 'question' && data.order === order) {
            updateStatsFromData(data);
          }
        }
      } catch (e) {}
    }, 1000);
  }
  
  function startFallback() {
    if (!fallbackInterval) fallbackInterval = createFallback();
  }
  
  function stopFallback() {
    if (fallbackInterval) {
      clearInterval(fallbackInterval);
      fallbackInterval = null;
    }
  }
  
  // Socket.IO setup
  let socket = null;
  let socketConnected = false;
  let fallbackInterval = null;
  
  if (typeof io !== 'undefined') {
    socket = io('http://localhost:8001', {
      transports: ['websocket', 'polling'],
      reconnection: true,
      reconnectionDelay: 500,
      reconnectionAttempts: 10
    });
    
    socket.on('connect', () => {
      socketConnected = true;
      socket.emit('join_session', {hash: hash});
      stopFallback();
    });
    
    socket.on('disconnect', () => {
      socketConnected = false;
      startFallback();
    });
    
    socket.on('connect_error', startFallback);
    
    socket.on('session_state', (data) => {
      if (data.state === 'finished') {
        window.location.href = resultsUrl;
      } else if (data.state === 'question' && data.order !== order) {
        window.location.href = `/session/${hash}/q/${data.order}/`;
      }
    });
    
    socket.on('answer_update', (data) => {
      if (data) {
        const dataOrder = data.question_order ?? data.order;
        if (dataOrder === order) updateStatsFromData(data);
      }
    });
    
    setTimeout(() => {
      if (!socketConnected) startFallback();
    }, 3000);
  } else {
    startFallback();
  }
})();
</script>
{% endif %}

{% if educational_materials_before %}
<script>
// PoznÃ¡mka: IIFE pattern pro izolaci scope a rozbalovÃ¡nÃ­/sbalovÃ¡nÃ­ materiÃ¡lÅ¯
(function() {
  function toggle(prefix, index) {
    const content = document.getElementById(`content-${prefix}-${index}`);
    const toggle = document.getElementById(`toggle-${prefix}-${index}`);
    if (content && toggle) {
      const isHidden = content.style.display === 'none';
      content.style.display = isHidden ? 'block' : 'none';
      toggle.textContent = isHidden ? 'â–²' : 'â–¼';
    }
  }
  window.toggleMaterialBefore = (index) => toggle('before', index);
})();
</script>
{% endif %}

{% endblock %}
