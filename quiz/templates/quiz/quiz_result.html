{% extends "base.html" %}
{% load wagtailcore_tags %}
{# Šablona pro zobrazení výsledků jednoduchého kvízu (bez live sezení) #}

{% block extra_js %}
<script>
function toggleMaterialAfter(index) {
  const content = document.getElementById(`content-after-${index}`);
  const toggle = document.getElementById(`toggle-after-${index}`);
  if (content && toggle) {
    const isHidden = content.style.display === 'none';
    content.style.display = isHidden ? 'block' : 'none';
    toggle.textContent = isHidden ? '▲' : '▼';
  }
}
</script>
{% endblock %}

{% block content %}
<div class="container quiz-container">
  <h1 class="quiz-title">Výsledky: {{ quiz.title }}</h1>
  
  {# Zobrazení skóre a procentuální úspěšnosti #}
  <div class="card pad result-card">
    <h2 class="result-score">
      Vaše skóre: {{ score }} / {{ total }}
    </h2>
    <p class="result-percentage">
      {% widthratio score total 100 %}% správně
    </p>
  </div>
  
  {# Zobrazení vzdělávacích materiálů po kvízu #}
  {% if educational_materials %}
    <div class="educational-materials card pad my-4">
      <h2>Doporučené materiály k prostudování</h2>
      <p class="text-muted">Pro lepší pochopení látky si můžete prostudovat následující materiály:</p>
      <ul class="material-list">
        {% for material in educational_materials %}
          <li class="material-item pad-sm bg-card rounded my-2">
            <div class="material-header" onclick="toggleMaterialAfter({{ forloop.counter0 }})">
              <div>
                <h3>{{ material.title }}</h3>
                <p class="text-muted">
                  Typ: {{ material.get_material_type_display }}
                  {% if material.video_file %}
                    | <a href="{{ material.video_file.url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); window.open(this.href, '_blank'); return false;">Video soubor ↗</a>
                  {% elif material.document_file %}
                    | <a href="{{ material.document_file.url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); window.open(this.href, '_blank'); return false;">Dokument ↗</a>
                  {% elif material.external_url %}
                    | <a href="{{ material.external_url }}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation(); window.open(this.href, '_blank'); return false;">Externí odkaz ↗</a>
                  {% endif %}
                </p>
              </div>
              <span class="material-toggle" id="toggle-after-{{ forloop.counter0 }}">▼</span>
            </div>
            {% if material.content %}
              <div class="material-content my-2" id="content-after-{{ forloop.counter0 }}">
                {{ material.content|richtext }}
              </div>
            {% endif %}
            {% if material.video_file %}
              <div class="material-content my-2" id="content-after-{{ forloop.counter0 }}">
                <video controls style="width: 100%; max-width: 800px;">
                  <source src="{{ material.video_file.url }}" type="video/mp4">
                  Váš prohlížeč nepodporuje video tag.
                </video>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
  
  {# Tlačítko pro návrat na seznam kvízů #}
  <div class="back-section">
    <a href="{% url 'quiz_list' %}" class="btn primary btn-large">
      Zpět na seznam kvízů
    </a>
  </div>
</div>
{% endblock %}
